version: '3.8'

services:
  pipeline:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: mlops-water-pipeline
    volumes:
      # Donn√©es
      - ./data:/app/data
      # Artefacts MLflow
      - ./mlruns:/app/mlruns
      - ./mlartifacts:/app/mlartifacts
      # Outputs - monter le dossier parent
      - ./:/app/
    working_dir: /app
  
  #service API
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: mlops-water-api
    ports:
      - "8000:8000"
    volumes:
      - ./mlruns:/app/mlruns
      - ./best_model.txt:/app/best_model.txt
    restart: unless-stopped
    depends_on:
      - pipeline